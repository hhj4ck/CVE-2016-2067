ADRENO GPU IOMMU DMA EXPLOIT by hhj4ck


Supported Devices:

Nexus 6p 

google/angler/angler:6.0.1/MMB29M/2431559:user/release-keys

Linux version 3.10.73-g9741316


The bug:

=== CVE-2016-2067 ===

[https://www.blackhat.com/docs/eu-16/materials/eu-16-Taft-GPU-Security-Exposed.pdf]


How does it work:

With iommu dma writes, vdso.so is overwritten with shellcode.

So after /init executes __kernel_clock_gettime, the shellcode will get executed.

/init process then connect back with a root shell.


Logs:

Reverse shell target: 127.0.0.1:4919

shellcode patch done

hook patch done

Waiting for reverse connect shell...

TERMINAL>>>

id

uid=0(root) gid=0(root) groups=0(root) context=u:r:init:s0


Tips:

Delete /data/local/tmp/x if any before the exploit.

If the waiting time is too long, try open "Time and Date" options inside the settings of your phone.


Porting to other devices:

Getting the gpu command to work, you need to check the verison of adreno, currently it is built for 4xx.

For 5xx and above, cp_type7_packet should replace cp_type3_packet.

Also IOCTL_KGSL_GPU_COMMAND instead of IOCTL_KGSL_RINGBUFFER_ISSUEIBCMDS.

